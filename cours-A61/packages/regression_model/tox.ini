# Grâce à Tox, nous pouvons (sur plusieurs systèmes d'exploitation) :
# Éliminer les problèmes liés à PYTHONPATH lors de l'exécution de scripts/tests
# Éliminer la confusion liée à la configuration de virtualenv
# Rationaliser certaines étapes telles que l'entraînement et la publication de modèles

[tox]
# Deux environnements de test différents pour notre projet :
# 1. regression_model - pour tester le fonctionnement du modèle
# 2. install_locally - pour vérifier que le package peut être correctement installé
envlist = regression_model, install_locally
# On saute l'étape de création du package (pas nécessaire pour nos tests)
skipsdist = True

[testenv:regression_model]
# Installation des dépendances listées dans requirements.txt
deps = -rrequirements.txt
# Configuration du chemin Python pour importer nos modules facilement
setenv =
    PYTHONPATH = {toxinidir}
# Séquence de commandes pour tester le modèle :
commands =
    # 1. Entraînement du modèle sur les données d'entraînement
    python regression_model/train_pipeline.py
    # 2. Exécution de tous les tests unitaires avec un niveau de détail élevé
    pytest -s -vv tests

[testenv:install_locally]
# Mêmes dépendances que l'environnement précédent
deps = -rrequirements.txt
# Même configuration du chemin Python
setenv =
    PYTHONPATH = {toxinidir}
# Commandes pour tester l'installation locale du package :
commands =
    # 1. Entraînement du modèle (vérification du bon fonctionnement)
    python regression_model/train_pipeline.py
    # 2. Génération des distributions du package (fichiers d'installation)
    python setup.py sdist bdist_wheel
