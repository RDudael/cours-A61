# Grâce à Tox, nous pouvons (sur plusieurs systèmes d'exploitation) :
# Éliminer les problèmes liés à PYTHONPATH lors de l'exécution de scripts/tests
# Éliminer la confusion liée à la configuration de virtualenv
# Rationaliser certaines étapes telles que l'entraînement et la publication de modèles

[tox]
# On définit deux environnements de test pour notre projet
envlist = regression_model, install_locally
# On saute l'étape de création du package (pas nécessaire pour ces tests)
skipsdist = True

[testenv:regression_model]
basepython = python
# Installation des dépendances depuis requirements.txt
deps =
    -rrequirements.txt

# On configure le chemin Python pour pouvoir importer nos modules facilement
setenv =
    PYTHONPATH = {toxinidir}

# Les commandes à exécuter pour tester le bon fonctionnement du modèle
commands =
    # D'abord, on entraîne le modèle sur les données de train
    python regression_model/train_pipeline.py
    # Ensuite, on lance tous les tests unitaires
    pytest -s -vv tests

[testenv:install_locally]
basepython = python
# Mêmes dépendances que pour l'environnement précédent
deps =
    -rrequirements.txt

# Commandes pour tester l'installation locale du package
commands =
    # On entraîne d'abord le modèle (pour s'assurer que tout fonctionne)
    python regression_model/train_pipeline.py
    # On génère les distributions du package (sdist et wheel)
    # Cela teste que setup.py fonctionne correctement
    python setup.py sdist bdist_wheel
