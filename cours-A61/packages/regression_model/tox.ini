# Grâce à Tox, nous pouvons (sur plusieurs systèmes d'exploitation) :
# Éliminer les problèmes liés à PYTHONPATH lors de l'exécution de scripts/tests
# Éliminer la confusion liée à la configuration de virtualenv
# Rationaliser certaines étapes telles que l'entraînement et la publication de modèles

[tox]
# On définit un seul environnement de test pour notre modèle de régression
envlist = regression_model
# On saute l'étape de création du package (pas nécessaire pour nos tests)
skipsdist = True

[testenv:regression_model]
# On utilise le Python par défaut du système
basepython = python
# On installe toutes les dépendances listées dans requirements.txt
deps =
    -rrequirements.txt

# On configure le chemin Python pour pouvoir importer nos modules facilement
setenv =
    PYTHONPATH = {toxinidir}

# Les commandes à exécuter dans l'ordre :
commands =
    # D'abord, on entraîne le modèle sur les données de train
    python regression_model/train_pipeline.py
    # Ensuite, on lance tous les tests pour vérifier que tout fonctionne
    pytest -s -vv tests